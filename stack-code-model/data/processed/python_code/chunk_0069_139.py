package com.mcleodgaming.elevator.views{	import com.mcleodgaming.elevator.Main;	import com.mcleodgaming.elevator.events.*;	import com.mcleodgaming.elevator.core.*;	import flash.events.*;	import flash.text.*;	import flash.display.*;	public class ElevatorViewAS3 extends ElevatorView	{		public var elevatorContainer:MovieClip;		public var elevatorMCs:Vector.<MovieClip>;		public var pauseButton:MovieClip;		public var floorTable:MovieClip;		public var floorMCs:Vector.<MovieClip>;		public function ElevatorViewAS3(e:ElevatorEngine):void {			super(e);			var self = this;			var i, mc, txtField;			//Create display elements			elevatorContainer = new MovieClip();			elevatorContainer.graphics.beginFill(0xffffff);			elevatorContainer.graphics.lineStyle(1, 0x000000);			elevatorContainer.graphics.drawRect(0, 0, Main.ROOT.stage.width, Main.ROOT.stage.height);			elevatorContainer.graphics.endFill();			elevatorMCs = new Vector.<MovieClip>();			for(i = 0; i < engine.elevators.length; i++) {				mc = new MovieClip(); //New elevator MC				mc.x = 100 * i + 100;				mc.y = 300;				mc.graphics.beginFill(0xffffff);				mc.graphics.lineStyle(1, 0x000000);				mc.graphics.drawRect(0, 0, 100, 150);				mc.graphics.endFill();				txtField = new TextField(); //Text field				txtField.width = 100;				txtField.height = 150;				txtField.name = "txt";				mc.addChild(txtField); //Add text field to elevator MC				elevatorMCs.push(mc); //Add elevator MC to list				elevatorContainer.addChild(mc); //Add to main container			}			//Build floor table			floorTable = new MovieClip();			floorMCs = new Vector.<MovieClip>();			for(i = 0; i < engine.floors.length; i++) {				mc = new MovieClip(); //New elevator MC				mc.y = 45 * i;				mc.graphics.beginFill(0xffffff);				mc.graphics.lineStyle(1, 0x000000);				mc.graphics.drawRect(0, 0, 100, 45);				mc.graphics.endFill();				txtField = new TextField();				txtField.width = 100;				txtField.height = 45;				txtField.multiline = true;				txtField.wordWrap = true;				txtField.name = "txt";				mc.addChild(txtField);				floorTable.addChild(mc);				floorMCs.push(mc);			}			//Make pause button to start/stop the engine and people adding timer			pauseButton = new MovieClip();			pauseButton.ispaused = false;			pauseButton.x = 600;			pauseButton.graphics.beginFill(0xffffff);			pauseButton.graphics.lineStyle(1, 0xffffff);			pauseButton.graphics.drawRect(0, 0, 100, 45);			pauseButton.graphics.endFill();			pauseButton.useHandCursor = true;			pauseButton.mouseChildren = false;			pauseButton.buttonMode = true;			txtField = new TextField();			txtField.width = 200;			txtField.height = 300;			txtField.selectable = false;			txtField.name = "txt";			txtField.text = "Pause";			txtField.mouseEnabled = false;			pauseButton.addEventListener(MouseEvent.CLICK, function(e:MouseEvent):void {				pauseButton.ispaused = !pauseButton.ispaused;				if(pauseButton.ispaused) {					TextField(pauseButton.getChildByName('txt')).text = "Play";					Main.ROOT.stopAddingPeople();					self.engine.stop();				} else {					TextField(pauseButton.getChildByName('txt')).text = "Pause";					self.engine.start();					Main.ROOT.startAddingPeople();				}			});			pauseButton.addChild(txtField);			//Add to ROOT			Main.ROOT.addChild(elevatorContainer);			Main.ROOT.addChild(floorTable);			Main.ROOT.addChild(pauseButton);			//Ready to accept events			EventDispatcher.dispatcher.addEventListener(ElevatorEngineEvent.UPDATE, onUpdate);			trace('Initialized ElevatorView');		}		public override function onUpdate(event:ElevatorEngineEvent):void {			var i, j;			//For each floor (Floor Table View)			for(i = 0; i < engine.floors.length; i++) {				TextField(floorMCs[engine.floors.length - i - 1].getChildByName('txt')).text = 'Floor ' + (i+1) + ': ';				//For each person on this floor				for(j = 0; j < engine.floors[i].people.length; j++) {					var prepend = (j > 0) ? ", " : "";					if(engine.queue.indexOf(engine.floors[i].people[j]) >= 0)						prepend += "*"; //Button press yet to be acknowledged					else if(engine.floors[i].people[j].state == PersonState.LEAVING || engine.floors[i].people[j].state == PersonState.ENTERING)						prepend += "+"; //Some elevator has responded to their button press					//Concatenate all of the people (placing in the table from the bottom up)					TextField(floorMCs[engine.floors.length - i - 1].getChildByName('txt')).text += (prepend + engine.floors[i].people[j].name + '(' + engine.floors[i].people[j].targetFloor.name + ')');				}			}			//Render elevators (Elevator View)			for(i = 0; i < engine.elevators.length; i++) {				var height = (elevatorMCs[i].height / elevatorContainer.height * 84); //<-Weird guessing to get the elevators to fit in the window				var offset = (engine.elevators[i].currentFloor.index / engine.floors.length * height);				elevatorMCs[i].y = 300 - Math.round(offset) * 10; //Lol guessing position here				TextField(elevatorMCs[i].getChildByName('txt')).text = getInfo(engine.elevators[i]);			}		}		public override function getInfo(elevator:Elevator):String {			return super.getInfo(elevator).split("<br />").join("\n");		}	}}