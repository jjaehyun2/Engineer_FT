package com.segonquart{	import flash.display.MovieClip;	import flash.display.CapsStyle;	import flash.events.Event;	import flash.events.ContextMenuEvent;	import flash.ui.ContextMenu;	import flash.ui.ContextMenuItem;	import flash.events.MouseEvent;	import flash.text.*;	import flash.text.TextField;	import flash.text.TextFormat;	import flash.text.TextFieldAutoSize;	import flash.net.URLRequest;	import flash.net.navigateToURL;	import com.segonquart.LoadingXML;	import com.segonquart.ThumbLoader;	import caurina.transitions.Tweener;	public class EventoNM extends MovieClip	{		private var file_xml:LoadingXML;		public var objects_array:Array=new Array();		public var thumbs_array:Array=new Array();		private var bg_array:Array=new Array();		private var clips_array:Array=new Array();		private var container_mc:MovieClip;		private var thumbs_container_mc:MovieClip;		private var thumbs_mc:MovieClip;		private var new_container_mc:MovieClip;		var news_txt:TextField;		private var thumb_mask_mc:ThumbMask;		private var counter:int = 0;		public function EventoNM ()		{			addEventListener (Event.ADDED_TO_STAGE,init);		}		private function init (evt:Event):void		{			removeEventListener (Event.ADDED_TO_STAGE,init);			stage.frameRate = 31;			createContainers ();			loadXML ();		}		private function createContainers ():void		{			thumbs_container_mc=new MovieClip();			thumbs_container_mc.alpha = 0;			addChild (thumbs_container_mc);			container_mc=new MovieClip();			addChild (container_mc);			new_container_mc=new MovieClip();			addChild (new_container_mc);		}		private function loadXML ():void		{			file_xml = new LoadingXML(this);		}		public function loadThumb ():void		{			var thumb_loader:ThumbLoader = new ThumbLoader(this,objects_array[counter].thumb,counter);			counter++;		}		public function loadingNewsComplete ():void		{			arrangeThumbs ();			Tweener.addTween (info_txt,{alpha:0,time:0.5,transition:"easeinoutsine",onComplete:createBackgroundsClips});		}		private function arrangeThumbs ():void		{			thumbs_mc=new MovieClip();			for (var i:int=0; i<thumbs_array.length; i++)			{				thumbs_mc.addChild (thumbs_array[i]);				thumbs_array[i].x = thumbs_array[i].width * i;			}			thumb_mask_mc=new ThumbMask();			thumbs_mc.mask = thumb_mask_mc;			thumbs_mc.x = stage.stageWidth - 140;			thumbs_mc.startX = thumbs_mc.x;			thumb_mask_mc.x = thumbs_mc.x;            news_txt= new TextField;			news_txt.autoSize = TextFieldAutoSize.LEFT;			news_txt.selectable = false;			news_txt.multiline = true;			news_txt.embedFonts = true;			news_txt.wordWrap = true;			news_txt.defaultTextFormat = getFormat(18,"Georgia",0xFFFFFF,false);			news_txt.width = 300;			news_txt.x = 60;			news_txt.alpha = .8;			thumbs_container_mc.addChild (thumbs_mc);			thumbs_container_mc.addChild (thumb_mask_mc);			thumbs_container_mc.addChild (news_txt);		}		function selectedNewsTextField (i:int):void		{			news_txt.text = objects_array[i].txt;		}		private function createBackgroundsClips ():void		{			var area:Number = stage.stageHeight - 150;			for (var i:int=0; i<objects_array.length; i++)			{				var container_title_mc:MovieClip=new MovieClip();				container_title_mc.id = i;				clips_array.push (container_title_mc);				container_title_mc.alpha = 0;				var bg_mc:MovieClip=new MovieClip();				bg_mc.graphics.moveTo (0,0);				bg_mc.graphics.lineStyle (40,0x000000,.55,false,"normal",CapsStyle.ROUND,null,3);				bg_mc.graphics.lineTo (950,0);				bg_mc.graphics.lineTo (950,area/objects_array.length);				bg_mc.graphics.lineTo (0,area/objects_array.length);				bg_mc.graphics.lineTo (0,0);				bg_mc.backgroundColor =0x000000;				bg_mc.width = 950;				bg_mc.height = area / objects_array.length - 20;				container_title_mc.addChild (bg_mc);				container_title_mc.x = 19;				container_title_mc.y = 10 + i * area / objects_array.length;				container_title_mc.startY = container_title_mc.y;				var title_txt:TextField = new TextField();				title_txt.autoSize = TextFieldAutoSize.LEFT;				title_txt.selectable = false;				title_txt.embedFonts = true;				title_txt.antiAliasType = AntiAliasType.ADVANCED;				title_txt.defaultTextFormat = getFormat(16,"Georgia",0x65FFFF,true);				title_txt.text = objects_array[i].title;				title_txt.width = title_txt.textWidth + 10;				title_txt.height = title_txt.textHeight;				title_txt.y = -5;				title_txt.alpha = .8;				container_title_mc.addChild (title_txt);				var date_txt:TextField = new TextField();				date_txt.autoSize = TextFieldAutoSize.LEFT;				date_txt.selectable = false;				date_txt.embedFonts = true;				date_txt.antiAliasType = AntiAliasType.ADVANCED;				date_txt.defaultTextFormat = getFormat(14,"Georgia",0xFFFFFE,true);				date_txt.text = objects_array[i].date;				date_txt.width = date_txt.textWidth + 10;				date_txt.height = date_txt.textHeight;				date_txt.x = stage.stageWidth / 2 - date_txt.width / 2;				date_txt.y = -5;				date_txt.alpha = .8;				container_title_mc.addChild (date_txt);				var cat_txt:TextField = new TextField();				cat_txt.autoSize = TextFieldAutoSize.LEFT;				cat_txt.selectable = false;				cat_txt.embedFonts = true;				cat_txt.antiAliasType = AntiAliasType.ADVANCED;				cat_txt.defaultTextFormat = getFormat(12,"Georgia",0x65FFFF,true);				cat_txt.text = objects_array[i].cat;				cat_txt.width = cat_txt.textWidth + 5;				cat_txt.height = cat_txt.textHeight;				cat_txt.x = stage.stageWidth - 170;				cat_txt.y = -10;				cat_txt.alpha = .8;				container_title_mc.addChild (cat_txt);				container_title_mc.mouseChildren = false;				container_title_mc.buttonMode = true;				container_title_mc.addEventListener (MouseEvent.MOUSE_OVER,callShowEvent);				container_title_mc.addEventListener (MouseEvent.MOUSE_DOWN,goURL);				container_mc.addChild (container_title_mc);				container_mc.y = 10;				if (i < objects_array.length - 1)				{					Tweener.addTween (container_title_mc,{alpha:1,time:0.3,delay:i*0.1,transition:"linear"});				}				else				{					Tweener.addTween (container_title_mc,{alpha:1,time:0.3,delay:i*0.1,transition:"linear",onComplete:showFirstEvent});				}			}		}		private function showFirstEvent ():void		{			showEvent (0);		}		private function callShowEvent (evt:MouseEvent):void		{			showEvent (evt.target.id);		}		private function goURL (evt:MouseEvent):void		{			var request:URLRequest = new URLRequest(objects_array[evt.target.id].url);			navigateToURL (request,"_blank");		}		private function showEvent (n:int):void		{			selectedNewsTextField (n);			for (var i:int=0; i<clips_array.length; i++)			{				if (i == n)				{					thumbs_container_mc.alpha = 0;					Tweener.addTween (thumbs_mc,{x:thumbs_mc.startX-n*80,time:0.5,transition:"easeOutCirc"});					Tweener.addTween (thumbs_container_mc,{y:clips_array[i].startY+60,time:0.5,transition:"easeOutCirc"});					Tweener.addTween (thumbs_container_mc,{alpha:1,time:0.5,transition:"linear"});					Tweener.addTween (clips_array[i],{y:clips_array[i].startY,time:0.3,transition:"easeOutCirc"});				}				if (i > n)				{					Tweener.addTween (clips_array[i],{y:clips_array[i].startY+140,time:0.3,transition:"easeOutCirc"});				}				if (i < n)				{					Tweener.addTween (clips_array[i],{y:clips_array[i].startY,time:0.3,transition:"easeOutCirc"});				}			}		}		private function getFormat (s:int,f:String,c:uint,b:Boolean):TextFormat		{			var format:TextFormat=new TextFormat();			format.size = s;			format.font = f;			format.color = c;			if (b)			{				format.bold = b;			}			return format;		}	}}